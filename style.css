* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
  background: #f4f6f8;
  color: #111;
  overflow: hidden;
}

/* コントロールバー */
.appbar {
  position: sticky; top: 0; z-index: 5;
  display: flex; align-items: center; gap: 10px;
  padding: 8px 10px; background: #1976d2; color: #fff;
}
.appbar h1 { margin: 0; font-size: 18px; font-weight: 600; flex: 1; }
.ghost { background:#1565c0; color:#fff; border:1px solid #0d47a1; border-radius:8px; padding:6px 10px; }
.pill  { background:#0b3a75; padding:2px 8px; border-radius:999px; font-variant-numeric: tabular-nums; }

.ctl{
  display:inline-flex; align-items:center; gap:6px;
  background: rgba(255,255,255,.15); padding:4px 6px; border-radius:10px;
}
.ctl.column{ flex-direction: column; align-items: stretch; gap:8px; }
.ctl button{
  background:#fff; color:#0b3a75; border:none; border-radius:8px;
  padding:6px 12px; min-width:42px; min-height:34px; font-size:16px;
}
.ctl span{ min-width:76px; text-align:center; color:#fff; }
.zoom-stack{ display:flex; flex-direction:column; align-items:center; gap:3px; }
#zoom-label{ min-width:64px; color:#fff; }
#zoom-reset{
  background:#fff; border:none; border-radius:8px; padding:4px 8px; font-size:12px; color:#0b3a75;
}

/* ステージ（横スワイプ検出のため pan-y 優先） */
#stage {
  position:relative; height: calc(100vh - 56px);
  overflow:auto; background:#eef1f5;
  touch-action: pan-y; /* 横はアプリで処理 */
}

/* ページレイヤ（PDFと手書きを一体で横スライド） */
#page-layer { position:relative; transform: translateX(0); transition: transform .18s ease; will-change: transform; }
#pdf-container { position:relative; z-index:1; margin:0 auto; }
#draw-layer   { position:absolute; left:0; top:0; z-index:2; touch-action:none; }

/* ツールバー（PDFに干渉しない） */
#sidebar{
  position: fixed; left:-280px; top:0; bottom:0; width:280px;
  background:#fff; border-right:1px solid #dde3ea; box-shadow:2px 0 10px rgba(0,0,0,.05);
  padding:12px; transition:left .25s ease; z-index:6; overflow:auto;
}
#sidebar.open { left:0; }
#sidebar h2 { margin:8px 2px 10px; font-size:16px; }
#sidebar button, #sidebar input[type="color"], #sidebar input[type="range"], #sidebar textarea, #sidebar select, #sidebar input[type="number"] {
  width:100%; margin:6px 0; padding:8px 10px; border-radius:8px; border:1px solid #e5e9ef; background:#fafbfc; font-family: inherit;
}
.tool-group .tool.active{ outline:2px solid #1976d2; background:#e8f1ff; }

/* 左端“つまみ” 当たり大きめ */
.edge-handle{
  position:fixed; left:0; top:50%; transform:translateY(-50%);
  width:28px; height:130px; border:none; background:#1e88e5; color:#fff;
  border-radius:0 10px 10px 0; cursor:pointer; opacity:.95; z-index:7;
  box-shadow: 2px 0 8px rgba(0,0,0,.15);
}
.edge-handle:focus{ outline:2px solid #90caf9; }

/* 手のひらON→描画抑止（移動優先） */
.hand-mode #draw-layer { pointer-events: none; }
.hand-mode { cursor: grab; }
.hand-dragging { cursor: grabbing; }

/* 採点UI */
.grade-box textarea, .grade-box input, .grade-box select {
  font-size: 14px;
}
.grade-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
#grade-run { width: 100%; padding: 10px; margin-top: 6px; }
.grade-result { margin-top: 8px; padding: 8px; background: #f8fbff; border: 1px solid #e0eefc; border-radius: 8px; font-size: 14px; }
.muted{ color:#667; font-size:12px; }

/* ノート背景 */
.paper-plain { background:#fff; }
.paper-ruled {
  background:
    linear-gradient(#e3e7ee 1px, transparent 1px) 0 0/100% 28px,
    #fff;
}
.paper-grid {
  background:
    linear-gradient(to right, rgba(0,0,0,.08) 1px, transparent 1px) 0 0/16px 16px,
    linear-gradient(to bottom, rgba(0,0,0,.08) 1px, transparent 1px) 0 0/16px 16px,
    #fff;
}
.paper-genkou {
  background:
    repeating-linear-gradient(to right, transparent, transparent 23px, rgba(0,0,0,.1) 24px),
    repeating-linear-gradient(to bottom, transparent, transparent 23px, rgba(0,0,0,.1) 24px),
    #fff;
}

@media (max-width: 920px){
  #stage { height: calc(100vh - 58px); }
}